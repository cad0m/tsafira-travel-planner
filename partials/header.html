<!-- Header with improved mobile design -->
<header id="header" class="fixed w-full bg-[var(--color-bg)] border-b border-[var(--color-border)] z-50">
  <nav class="container mx-auto px-4 py-3 flex items-center justify-between">
    <!-- Logo -->
    <a href="/pages/index.html" class="text-2xl font-bold text-[var(--color-primary)]">Tsafira</a>
    
    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center space-x-6">
      <a href="/pages/index.html" class="text-[var(--color-text)] hover:text-[var(--color-primary)]">Home</a>
      <a href="/pages/destinations.html" class="text-[var(--color-text)] hover:text-[var(--color-primary)]">Destinations</a>
      <a href="/pages/how-it-works.html" class="text-[var(--color-text)] hover:text-[var(--color-primary)]">How It Works</a>
      <a href="/pages/about.html" class="text-[var(--color-text)] hover:text-[var(--color-primary)]">About</a>
      <a href="/pages/contact.html" class="text-[var(--color-text)] hover:text-[var(--color-primary)]">Contact</a>
    </div>
    
    <!-- Desktop Auth + Theme + CTA -->
    <div class="hidden md:flex items-center space-x-4">
      <!-- Theme Toggle -->
      <button 
        id="theme-toggle" 
        class="p-2 rounded-full hover:bg-[var(--color-bg-alt)] text-[var(--color-text)]"
        data-theme-toggle
        onclick="toggleTheme(this); return false;"
      >
        <i class="fas fa-moon moon-icon"></i>
        <i class="fas fa-sun sun-icon hidden"></i>
      </button>
      
      <!-- Auth Actions -->
      <div id="nav-actions" class="flex items-center space-x-4">
        <!-- Will be populated by auth.js -->
        <a href="/pages/signin.html" class="px-4 py-2 rounded-full border-2 border-transparent text-[var(--color-text)] hover:border-[var(--color-primary)]">
          Sign In
        </a>
        <a href="/pages/wizard.html" class="bg-[var(--color-primary)] text-[var(--color-text-inverse)] px-6 py-2 rounded-full hover:bg-[var(--color-primary-hover)]">
          Plan Your Trip
        </a>
      </div>
    </div>
    
    <!-- Mobile CTA + Menu Button -->
    <div class="flex items-center space-x-2 md:hidden">
      <!-- Theme Toggle -->
      <button 
        id="theme-toggle-mobile" 
        class="p-2 rounded-full hover:bg-[var(--color-bg-alt)] text-[var(--color-text)]"
        data-theme-toggle
        onclick="toggleTheme(this); return false;"
      >
        <i class="fas fa-moon moon-icon"></i>
        <i class="fas fa-sun sun-icon hidden"></i>
      </button>
      
      <a href="/pages/signin.html" class="text-[var(--color-text)] hover:text-[var(--color-primary)]">
        <i class="fas fa-user"></i>
      </a>
      
      <a href="/pages/wizard.html" class="bg-[var(--color-primary)] text-[var(--color-text-inverse)] px-4 py-1.5 rounded-full text-sm hover:bg-[var(--color-primary-hover)]">
        Plan Trip
      </a>
      <button 
        id="mobile-menu-button" 
        class="p-2 rounded-md text-[var(--color-text)] hover:bg-[var(--color-bg-alt)]"
        onclick="openMobileMenu(); return false;"
      >
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>
</header>

<!-- Improved Mobile Menu -->
<div id="mobile-menu" class="fixed inset-0 bg-[var(--color-bg)] z-50 md:hidden" style="display: none;">
  <div class="flex flex-col h-full">
    <!-- Header with close button -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-[var(--color-border)]">
      <a href="/pages/index.html" class="text-2xl font-bold text-[var(--color-primary)]">Tsafira</a>
      <button 
        id="close-menu-button" 
        class="p-2 rounded-md text-[var(--color-text)] hover:bg-[var(--color-bg-alt)]"
        onclick="closeMobileMenu(); return false;"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Navigation Links -->
    <div class="flex-grow overflow-y-auto">
      <div class="py-2">
        <a href="/pages/index.html" class="block px-6 py-3 text-[var(--color-text)] hover:bg-[var(--color-bg-alt)] hover:text-[var(--color-primary)] border-l-4 border-transparent hover:border-[var(--color-primary)]">Home</a>
        <a href="/destinations.html" class="block px-6 py-3 text-[var(--color-text)] hover:bg-[var(--color-bg-alt)] hover:text-[var(--color-primary)] border-l-4 border-transparent hover:border-[var(--color-primary)]">Destinations</a>
        <a href="/pages/how-it-works.html" class="block px-6 py-3 text-[var(--color-text)] hover:bg-[var(--color-bg-alt)] hover:text-[var(--color-primary)] border-l-4 border-transparent hover:border-[var(--color-primary)]">How It Works</a>
        <a href="/pages/about.html" class="block px-6 py-3 text-[var(--color-text)] hover:bg-[var(--color-bg-alt)] hover:text-[var(--color-primary)] border-l-4 border-transparent hover:border-[var(--color-primary)]">About</a>
        <a href="/pages/contact.html" class="block px-6 py-3 text-[var(--color-text)] hover:bg-[var(--color-bg-alt)] hover:text-[var(--color-primary)] border-l-4 border-transparent hover:border-[var(--color-primary)]">Contact</a>
      </div>
    </div>
    
    <!-- Auth Actions -->
    <div class="px-6 py-4 border-t border-[var(--color-border)]">
      <div id="mobile-nav-actions">
        <!-- Will be populated by auth.js -->
        <a href="/pages/signin.html" class="block w-full text-center mb-3 px-4 py-2 border-2 border-[var(--color-border)] rounded-full text-[var(--color-text)] hover:border-[var(--color-primary)]">
          Sign In
        </a>
        <a href="/pages/wizard.html" class="block w-full text-center bg-[var(--color-primary)] text-[var(--color-text-inverse)] px-4 py-2 rounded-full hover:bg-[var(--color-primary-hover)]">
          Plan Your Trip
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  /* Ensure mobile menu is hidden on page load */
  #mobile-menu {
    display: none !important;
  }
  
  /* Transition for mobile menu */
  #mobile-menu.visible {
    display: block !important;
    animation: fadeIn 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>

<script>
  // Direct inline scripts to ensure functionality even if JS modules fail
  function toggleTheme(button) {
    // Toggle dark/light theme
    const html = document.documentElement;
    const isDark = html.classList.contains('dark');
    
    if (isDark) {
      html.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    } else {
      html.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    }
    
    // Update button icons
    const moonIcon = button.querySelector('.moon-icon, .fa-moon');
    const sunIcon = button.querySelector('.sun-icon, .fa-sun');
    
    if (moonIcon && sunIcon) {
      if (!isDark) { // Now dark
        moonIcon.classList.add('hidden');
        sunIcon.classList.remove('hidden');
      } else { // Now light
        moonIcon.classList.remove('hidden');
        sunIcon.classList.add('hidden');
      }
    }
    
    // Update all other theme toggles
    const allToggles = document.querySelectorAll('[data-theme-toggle], #theme-toggle, #theme-toggle-mobile');
    allToggles.forEach(toggle => {
      if (toggle !== button) {
        const otherMoonIcon = toggle.querySelector('.moon-icon, .fa-moon');
        const otherSunIcon = toggle.querySelector('.sun-icon, .fa-sun');
        
        if (otherMoonIcon && otherSunIcon) {
          if (!isDark) { // Now dark
            otherMoonIcon.classList.add('hidden');
            otherSunIcon.classList.remove('hidden');
          } else { // Now light
            otherMoonIcon.classList.remove('hidden');
            otherSunIcon.classList.add('hidden');
          }
        }
      }
    });
  }
  
  function openMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuButton = document.getElementById('mobile-menu-button');
    
    if (mobileMenu) {
      // Show the menu
      mobileMenu.style.display = 'block';
      setTimeout(() => {
        mobileMenu.classList.add('visible');
      }, 10);
      
      // Change hamburger to X
      const icon = menuButton.querySelector('i');
      if (icon) {
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
      }
      
      // Prevent scrolling
      document.body.style.overflow = 'hidden';
    }
  }
  
  function closeMobileMenu() {
    const mobileMenu = document.getElementById('mobile-menu');
    const menuButton = document.getElementById('mobile-menu-button');
    
    if (mobileMenu) {
      // Hide the menu
      mobileMenu.classList.remove('visible');
      
      // Change X back to hamburger
      const icon = menuButton.querySelector('i');
      if (icon) {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
      }
      
      // Wait for animation to complete
      setTimeout(() => {
        mobileMenu.style.display = 'none';
        document.body.style.overflow = '';
      }, 300);
    }
  }
  
  // Apply theme on load
  document.addEventListener('DOMContentLoaded', function() {
    const storedTheme = localStorage.getItem('theme') || 'light';
    const html = document.documentElement;
    
    // Set theme class
    if (storedTheme === 'dark') {
      html.classList.add('dark');
    } else {
      html.classList.remove('dark');
    }
    
    // Update toggle button icons
    const isDark = html.classList.contains('dark');
    const toggles = document.querySelectorAll('[data-theme-toggle], #theme-toggle, #theme-toggle-mobile');
    
    toggles.forEach(toggle => {
      const moonIcon = toggle.querySelector('.moon-icon, .fa-moon');
      const sunIcon = toggle.querySelector('.sun-icon, .fa-sun');
      
      if (moonIcon && sunIcon) {
        if (isDark) {
          moonIcon.classList.add('hidden');
          sunIcon.classList.remove('hidden');
        } else {
          moonIcon.classList.remove('hidden');
          sunIcon.classList.add('hidden');
        }
      }
    });
  });
</script>